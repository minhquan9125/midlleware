<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω L·ªãch Kh√°m T·ª± ƒê·ªông</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #4CAF50;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f1f8e9;
            border-radius: 8px;
            border: 1px solid #c8e6c9;
            display: none;
        }

        .results.show {
            display: block;
        }

        .results.error {
            background: #ffebee;
            border-color: #ffcdd2;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .appointment-list {
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .appointment-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .appointment-item:last-child {
            border-bottom: none;
        }

        .status-success {
            color: #4CAF50;
            font-weight: bold;
        }

        .status-failed {
            color: #f44336;
            font-weight: bold;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            width: min(900px, 95vw);
            max-height: 85vh;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: #f5f7fb;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h4 {
            margin: 0;
            font-size: 18px;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            padding: 16px 20px 20px 20px;
            overflow: auto;
        }

        .list-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .list-table th,
        .list-table td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid #eef2f7;
        }

        .list-table th {
            background: #f8fafc;
            color: #555;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Qu·∫£n L√Ω L·ªãch Kh√°m T·ª± ƒê·ªông</h1>
            <p>T·ª± ƒë·ªông t·∫°o l·ªãch kh√°m s·ª©c kh·ªèe ƒë·ªãnh k·ª≥ cho nh√¢n s·ª± t·ª´ HR System</p>
        </div>

        <div class="content">
            <!-- Ki·ªÉm tra nh√¢n vi√™n c·∫ßn kh√°m -->
            <div class="form-section">
                <h3>üîç Ki·ªÉm tra nh√¢n vi√™n c·∫ßn kh√°m (>6 th√°ng)</h3>
                <p style="color: #666; margin-bottom: 20px;">T·ª± ƒë·ªông t·∫°o l·ªãch kh√°m cho nh√¢n vi√™n ch∆∞a kh√°m s·ª©c kh·ªèe trong 6 th√°ng g·∫ßn ƒë√¢y</p>
                <button type="button" onclick="autoCreateOverdueCheckups()" class="btn">
                    üè• Ki·ªÉm tra v√† t·∫°o l·ªãch t·ª± ƒë·ªông
                </button>
            </div>

            <div class="form-section">
                <h3>üìö Danh s√°ch nhanh</h3>
                <p style="color: #666; margin-bottom: 20px;">Xem danh s√°ch Doctors v√† Employees t·ª´ Middleware</p>
                <button type="button" class="btn secondary" onclick="openListModal('doctors')">üë®‚Äç‚öïÔ∏è Doctor</button>
                <button type="button" class="btn secondary" onclick="openListModal('employees')">üë• Employees</button>
            </div>

            <hr style="margin: 30px 0; border: 1px solid #eee;">

            <!-- Form T·∫°o L·ªãch Kh√°m T·ª± ƒê·ªông -->
            <div class="form-section">
                <h3>üìÖ T·∫°o L·ªãch Kh√°m T·ª± ƒê·ªông</h3>
                <form id="autoScheduleForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="doctorId">ID B√°c Sƒ© *</label>
                            <input type="text" id="doctorId" name="doctorId" required 
                                   placeholder="Nh·∫≠p ID c·ªßa b√°c sƒ©" value="doctor_001">
                        </div>
                        <div class="form-group">
                            <label for="scheduledDate">Ng√†y Kh√°m *</label>
                            <input type="datetime-local" id="scheduledDate" name="scheduledDate" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="checkupType">Lo·∫°i Kh√°m</label>
                            <select id="checkupType" name="checkupType">
                                <option value="Kh√°m s·ª©c kh·ªèe ƒë·ªãnh k·ª≥">Kh√°m s·ª©c kh·ªèe ƒë·ªãnh k·ª≥</option>
                                <option value="Kh√°m t·ªïng qu√°t">Kh√°m t·ªïng qu√°t</option>
                                <option value="Kh√°m chuy√™n khoa">Kh√°m chuy√™n khoa</option>
                                <option value="T·∫ßm so√°t ung th∆∞">T·∫ßm so√°t ung th∆∞</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="department">Ph√≤ng Ban</label>
                            <select id="department" name="department">
                                <option value="all">T·∫•t c·∫£ ph√≤ng ban</option>
                                <option value="IT">IT</option>
                                <option value="HR">Nh√¢n s·ª±</option>
                                <option value="Finance">T√†i ch√≠nh</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Sales">Kinh doanh</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn">üöÄ T·∫°o L·ªãch Kh√°m T·ª± ƒê·ªông</button>
                        <button type="button" class="btn secondary" onclick="loadUpcomingCheckups()">üìã Xem L·ªãch S·∫Øp T·ªõi</button>
                    </div>
                </form>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ƒêang x·ª≠ l√Ω... Vui l√≤ng ƒë·ª£i</p>
            </div>

            <!-- K·∫øt Qu·∫£ -->
            <div class="results" id="results">
                <!-- Th·ªëng k√™ -->
                <div class="stats" id="stats">
                    <!-- Stats s·∫Ω ƒë∆∞·ª£c render b·∫±ng JavaScript -->
                </div>

                <!-- Danh s√°ch cu·ªôc h·∫πn -->
                <div class="appointment-list" id="appointmentList">
                    <!-- Appointments s·∫Ω ƒë∆∞·ª£c render b·∫±ng JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="listModal" onclick="handleModalBackdrop(event)">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <div class="modal-header">
                <h4 id="modalTitle">Danh s√°ch</h4>
                <button class="modal-close" onclick="closeListModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <script>
        // Thi·∫øt l·∫≠p ng√†y m·∫∑c ƒë·ªãnh (ng√†y mai l√∫c 8:00)
        document.addEventListener('DOMContentLoaded', function() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(8, 0, 0, 0);
            
            const formatted = tomorrow.toISOString().slice(0, 16);
            document.getElementById('scheduledDate').value = formatted;
        });

        // X·ª≠ l√Ω form submit
        document.getElementById('autoScheduleForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            showLoading(true);
            hideResults();
            
            try {
                const response = await fetch('/api/gateway/schedule/auto-create-checkups', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                showLoading(false);
                
                if (result.success) {
                    showResults(result.data, false);
                } else {
                    showError(result.message);
                }
                
            } catch (error) {
                showLoading(false);
                showError('L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        });

        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function hideResults() {
            document.getElementById('results').classList.remove('show', 'error');
        }

        function showResults(data, isError = false) {
            const resultsDiv = document.getElementById('results');
            const statsDiv = document.getElementById('stats');
            const appointmentList = document.getElementById('appointmentList');
            
            if (isError) {
                resultsDiv.classList.add('error');
                appointmentList.innerHTML = `<p style="color: #f44336; text-align: center; padding: 20px;">${data}</p>`;
                statsDiv.innerHTML = '';
            } else {
                resultsDiv.classList.remove('error');
                
                // Render th·ªëng k√™
                statsDiv.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${data.summary.totalEmployees}</div>
                        <div class="stat-label">T·ªïng Nh√¢n Vi√™n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #4CAF50;">${data.summary.successCount}</div>
                        <div class="stat-label">T·∫°o Th√†nh C√¥ng</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #f44336;">${data.summary.failedCount}</div>
                        <div class="stat-label">Th·∫•t B·∫°i</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${Math.round((data.summary.successCount / data.summary.totalEmployees) * 100)}%</div>
                        <div class="stat-label">T·ª∑ L·ªá Th√†nh C√¥ng</div>
                    </div>
                `;
                
                // Render danh s√°ch appointments
                let appointmentHTML = '<h4 style="margin-bottom: 15px;">üìã Danh S√°ch L·ªãch Kh√°m ƒê√£ T·∫°o</h4>';
                
                data.createdAppointments.forEach(appointment => {
                    appointmentHTML += `
                        <div class="appointment-item">
                            <div>
                                <strong>${appointment.employee}</strong> (${appointment.employeeId})<br>
                                <small>${new Date(appointment.appointmentTime).toLocaleString('vi-VN')}</small>
                            </div>
                            <span class="status-success">‚úÖ Th√†nh c√¥ng</span>
                        </div>
                    `;
                });
                
                if (data.failedAppointments.length > 0) {
                    appointmentHTML += '<h4 style="margin: 20px 0 15px 0; color: #f44336;">‚ùå Danh S√°ch Th·∫•t B·∫°i</h4>';
                    data.failedAppointments.forEach(appointment => {
                        appointmentHTML += `
                            <div class="appointment-item">
                                <div>
                                    <strong>${appointment.employee}</strong> (${appointment.employeeId})<br>
                                    <small style="color: #f44336;">${appointment.error}</small>
                                </div>
                                <span class="status-failed">‚ùå Th·∫•t b·∫°i</span>
                            </div>
                        `;
                    });
                }
                
                appointmentList.innerHTML = appointmentHTML;
            }
            
            resultsDiv.classList.add('show');
        }

        function showError(message) {
            showResults(message, true);
        }

        async function loadUpcomingCheckups() {
            const doctorId = document.getElementById('doctorId').value;
            if (!doctorId) {
                alert('Vui l√≤ng nh·∫≠p ID b√°c sƒ©');
                return;
            }
            
            showLoading(true);
            
            try {
                const response = await fetch(`/api/gateway/schedule/upcoming-checkups/${doctorId}`);
                const result = await response.json();
                
                showLoading(false);
                
                if (result.success) {
                    // Hi·ªÉn th·ªã l·ªãch s·∫Øp t·ªõi
                    let upcomingHTML = '<h4 style="margin-bottom: 15px;">üìÖ L·ªãch Kh√°m S·∫Øp T·ªõi</h4>';
                    
                    if (result.data.upcomingCheckups.length === 0) {
                        upcomingHTML += '<p style="text-align: center; color: #666;">Kh√¥ng c√≥ l·ªãch kh√°m n√†o s·∫Øp t·ªõi</p>';
                    } else {
                        result.data.upcomingCheckups.forEach(checkup => {
                            upcomingHTML += `
                                <div class="appointment-item">
                                    <div>
                                        <strong>${checkup.type}</strong><br>
                                        <small>${checkup.date} ${checkup.time} - ${checkup.patientCount} b·ªánh nh√¢n</small><br>
                                        <small>${checkup.department}</small>
                                    </div>
                                    <span class="status-success">üìÖ ƒê√£ l√™n l·ªãch</span>
                                </div>
                            `;
                        });
                    }
                    
                    document.getElementById('appointmentList').innerHTML = upcomingHTML;
                    document.getElementById('stats').innerHTML = '';
                    document.getElementById('results').classList.add('show');
                    document.getElementById('results').classList.remove('error');
                } else {
                    showError(result.message);
                }
                
            } catch (error) {
                showLoading(false);
                showError('L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }
        // H√†m m·ªõi: T·ª± ƒë·ªông ki·ªÉm tra v√† t·∫°o l·ªãch cho nh√¢n vi√™n c·∫ßn kh√°m
        async function autoCreateOverdueCheckups() {
            try {
                showLoading(true);

                const response = await fetch('/api/gateway/schedule/auto-checkup-overdue', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                showLoading(false);

                if (result.success) {
                    // Hi·ªÉn th·ªã th·ªëng k√™
                    const stats = document.getElementById('stats');
                    stats.innerHTML = `
                        <h4 style="margin-bottom: 20px;">üìä K·∫øt Qu·∫£ Ki·ªÉm Tra Nh√¢n Vi√™n</h4>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${result.data.summary.totalEmployees}</div>
                                <div class="stat-label">T·ªïng Nh√¢n Vi√™n</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #ff9800;">${result.data.summary.employeesNeedingCheckup}</div>
                                <div class="stat-label">C·∫ßn Kh√°m (>6 th√°ng)</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #4CAF50;">${result.data.summary.schedulesCreated}</div>
                                <div class="stat-label">ƒê√£ T·∫°o L·ªãch</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #2196F3;">${result.data.summary.availableDoctors}</div>
                                <div class="stat-label">B√°c Sƒ© C√≥ S·∫µn</div>
                            </div>
                        </div>
                        <p style="margin-top: 15px; color: #666; text-align: center;">
                            üìÖ Ki·ªÉm tra t·ª´ ng√†y: <strong>${result.data.summary.checkFromDate}</strong>
                        </p>
                    `;

                    // Hi·ªÉn th·ªã danh s√°ch l·ªãch kh√°m ƒë√£ t·∫°o
                    const appointmentList = document.getElementById('appointmentList');
                    let appointmentHTML = '<h4 style="margin-bottom: 15px;">üìã Danh S√°ch L·ªãch Kh√°m ƒê√£ T·∫°o</h4>';
                    
                    if (result.data.createdSchedules.length === 0) {
                        appointmentHTML += `
                            <div style="text-align: center; padding: 20px; background: #e8f5e8; border-radius: 8px; color: #2e7d32;">
                                <h3>üéâ Tuy·ªát v·ªùi!</h3>
                                <p>T·∫•t c·∫£ ${result.data.summary.totalEmployees} nh√¢n vi√™n ƒë·ªÅu ƒë√£ kh√°m s·ª©c kh·ªèe trong 6 th√°ng g·∫ßn ƒë√¢y.</p>
                            </div>
                        `;
                    } else {
                        result.data.createdSchedules.forEach((schedule, index) => {
                            appointmentHTML += `
                                <div class="appointment-item">
                                    <div>
                                        <strong>${schedule.employee}</strong> (ID: ${schedule.employeeId})<br>
                                        <small>üìß ${schedule.email}</small><br>
                                        <small>üè• ${schedule.doctorName}</small><br>
                                        <small>üìÖ ${schedule.scheduledDate} l√∫c ${schedule.scheduledTime}</small><br>
                                        <small style="color: #f57c00;">‚è∞ Kh√°m cu·ªëi: ${schedule.lastHealthCheck} (${schedule.monthsOverdue} th√°ng tr∆∞·ªõc)</small>
                                    </div>
                                    <span class="status-success">‚úÖ ƒê√£ l√™n l·ªãch</span>
                                </div>
                            `;
                        });
                    }

                    // Hi·ªÉn th·ªã l·ªãch th·∫•t b·∫°i (n·∫øu c√≥)
                    if (result.data.failedSchedules && result.data.failedSchedules.length > 0) {
                        appointmentHTML += '<h4 style="margin: 20px 0 15px 0; color: #f44336;">‚ùå Danh S√°ch Th·∫•t B·∫°i</h4>';
                        result.data.failedSchedules.forEach(failed => {
                            appointmentHTML += `
                                <div class="appointment-item">
                                    <div>
                                        <strong>${failed.employee}</strong> (ID: ${failed.employeeId})<br>
                                        <small style="color: #f44336;">‚ùå ${failed.error}</small><br>
                                        <small>‚è∞ Kh√°m cu·ªëi: ${failed.lastHealthCheck}</small>
                                    </div>
                                    <span class="status-failed">‚ùå Th·∫•t b·∫°i</span>
                                </div>
                            `;
                        });
                    }

                    // Hi·ªÉn th·ªã danh s√°ch b√°c sƒ©
                    if (result.data.doctorsList && result.data.doctorsList.length > 0) {
                        appointmentHTML += '<h4 style="margin: 20px 0 15px 0;">üë®‚Äç‚öïÔ∏è Danh S√°ch B√°c Sƒ© Tham Gia</h4>';
                        appointmentHTML += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-bottom: 20px;">';
                        result.data.doctorsList.forEach(doctor => {
                            appointmentHTML += `
                                <div style="padding: 10px; background: #f0f8ff; border-radius: 8px; border: 1px solid #e1f5fe;">
                                    <strong>${doctor.name}</strong><br>
                                    <small>${doctor.specialization} - ${doctor.department}</small>
                                </div>
                            `;
                        });
                        appointmentHTML += '</div>';
                    }

                    appointmentList.innerHTML = appointmentHTML;

                    document.getElementById('results').classList.add('show');
                    document.getElementById('results').classList.remove('error');
                    
                    // Th√¥ng b√°o th√†nh c√¥ng
                    if (result.data.summary.schedulesCreated > 0) {
                        alert(`üéâ ƒê√£ t·ª± ƒë·ªông t·∫°o th√†nh c√¥ng ${result.data.summary.schedulesCreated} l·ªãch kh√°m cho nh√¢n vi√™n c·∫ßn kh√°m s·ª©c kh·ªèe!`);
                    }
                } else {
                    showError(result.message);
                }

            } catch (error) {
                showLoading(false);
                showError('L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        async function openListModal(type) {
            const modal = document.getElementById('listModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalTitle.textContent = type === 'doctors' ? 'Danh s√°ch Doctors' : 'Danh s√°ch Employees';
            modalBody.innerHTML = '<p>ƒêang t·∫£i d·ªØ li·ªáu...</p>';
            modal.classList.add('show');

            try {
                const endpoint = type === 'doctors' ? '/api/gateway/hospital/doctors' : '/api/gateway/hospital/employees';
                const response = await fetch(endpoint);
                const result = await response.json();

                if (!result.success) {
                    modalBody.innerHTML = `<p style="color: #f44336;">${result.message || 'Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu'}</p>`;
                    return;
                }

                const items = Array.isArray(result.data) ? result.data : [];
                if (items.length === 0) {
                    modalBody.innerHTML = '<p>Kh√¥ng c√≥ d·ªØ li·ªáu.</p>';
                    return;
                }

                if (type === 'doctors') {
                    modalBody.innerHTML = `
                        <table class="list-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>T√™n b√°c sƒ©</th>
                                    <th>Chuy√™n khoa</th>
                                    <th>Khoa</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${items.map(doc => `
                                    <tr>
                                        <td>${doc.id ?? ''}</td>
                                        <td>${doc.name ?? ''}</td>
                                        <td>${doc.specialization ?? ''}</td>
                                        <td>${doc.department ?? ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    modalBody.innerHTML = `
                        <table class="list-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>H·ªç t√™n</th>
                                    <th>Email</th>
                                    <th>Ph√≤ng ban</th>
                                    <th>L·∫ßn cu·ªëi kh√°m</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${items.map(emp => {
                                    const fullName = `${emp.firstName ?? ''} ${emp.lastName ?? ''}`.trim();
                                    const lastCheck = emp.lastHealthCheckDate
                                        ? new Date(emp.lastHealthCheckDate).toLocaleDateString('vi-VN')
                                        : 'Ch∆∞a kh√°m';
                                    return `
                                        <tr>
                                            <td>${emp.id ?? ''}</td>
                                            <td>${fullName || emp.name || ''}</td>
                                            <td>${emp.email ?? ''}</td>
                                            <td>${emp.department ?? ''}</td>
                                            <td>${lastCheck}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                }
            } catch (error) {
                modalBody.innerHTML = `<p style="color: #f44336;">L·ªói k·∫øt n·ªëi: ${error.message}</p>`;
            }
        }

        function closeListModal() {
            document.getElementById('listModal').classList.remove('show');
        }

        function handleModalBackdrop(event) {
            if (event.target.id === 'listModal') {
                closeListModal();
            }
        }
    </script>
</body>
</html>